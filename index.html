<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>レシピ検索</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: auto; }
    h1 { color: #333; }
    input { padding: 8px; width: 300px; margin-bottom: 20px; }
    ul { list-style: none; padding: 0; }
    li { background: #f9f9f9; margin: 12px 0; padding: 12px; border-radius: 8px; }
    img { max-width: 250px; display: block; margin-top: 8px; border-radius: 6px; }
  </style>
</head>
<body>
  <h1>レシピ検索</h1>
  <input type="text" id="searchBox" placeholder="食材や料理名で検索してください...">
  <ul id="results"></ul>

  <script>
    fetch("recipes.json")
      .then(response => response.json())
      .then(data => {
        const searchBox = document.getElementById("searchBox");
        const results = document.getElementById("results");

        searchBox.addEventListener("input", () => {
          const keyword = searchBox.value.toLowerCase();

          const filtered = data.filter(item =>
            item["使用したシネコ生産物"].toLowerCase().includes(keyword) ||
            item["料理名(活用方法)"].toLowerCase().includes(keyword)
          );

          results.innerHTML = filtered.map(item => {
            // ✅ 作成日を日本時間に補正して日付文字列を生成
            const dateObj = new Date(item["作成日"]);
            dateObj.setHours(dateObj.getHours() + 9); // UTC→JST補正

            const yyyy = dateObj.getFullYear();
            const mm = String(dateObj.getMonth() + 1).padStart(2, "0");
            const dd = String(dateObj.getDate()).padStart(2, "0");
            const dateStr = `${yyyy}${mm}${dd}`;

            // ✅ ファイル名用に料理名を調整（スペース→アンダースコア）
            let recipeName = item["料理名(活用方法)"];
            recipeName = recipeName.replace(/\s+/g, "_");

            const fileName = `${dateStr}_${recipeName}.jpg`;
            const imagePath = `images_compressed/${fileName}`;

            // デバッグ用: 実際に生成されたファイル名を出力
            console.log("生成されたファイル名:", fileName);

            return `
              <li>
                <h3>${item["料理名(活用方法)"]}</h3>
                <p><b>食材:</b> ${item["使用したシネコ生産物"]}</p>
                <img src="${imagePath}" alt="${item["料理名(活用方法)"]}" 
                     onerror="this.style.display='none'">
              </li>
            `;
          }).join("");
        });
      });
  </script>
</body>
</html>
